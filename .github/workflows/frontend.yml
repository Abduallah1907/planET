name: Frontend CI Workflow

on:
  push:
    branches:
      - main 
  pull_request:
    branches:
      - main 

jobs:
  build:
    runs-on: windows-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        run: |
          cd Frontend
          npm install

      - name: Start the application
        run: |
          cd Frontend
          npm start &
      
      - name: Wait for server to be ready
        run: |
          echo "Waiting for the server to be ready..."
          $serverUp = $false
          $maxRetries = 50
          $retries = 0
          while ($serverUp -eq $false -and $retries -lt $maxRetries) {
            $retries++
            try {
              $response = Invoke-WebRequest -Uri http://localhost:3000 -TimeoutSec 20
              echo "server is $serverUp"
              if ($response.StatusCode -eq 200) {
                $serverUp = $true
                echo "Server is up!"
                exit 0
              }
            } catch {
              echo "Server not up yet... Retrying ($retries/$maxRetries)"
              Start-Sleep -Seconds 20
            }
          }
          if (-not $serverUp) {
            echo "Server did not start in time!"
            exit 1
          }
